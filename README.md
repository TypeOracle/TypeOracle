# Experimental Setup

## Target Programs

Adobe Reader v2021.011.20039

Foxit Reader v11.2.1.53537

## Computing Resources

Windows 8.1 virtual machine

One core CPU with 4G memory

Host-machine: 8cores(Intel i7-6700@4.00GHz) and 32G memory

VirtualBox

 
# Experimental Data

## Accuracy (Table 1)

### adobe reader

#### data

infered_type/: type information generated by TypeOracle
ground_truth/: correct type information (from reverse engineering)

#### utility

adobe.txt: comparasion log file
cmp_arg.py: the script file to compare type information

#### result

adobe_sample_result.txt: accuracy log file (the detail of accuracy comparasion)

### foxit reader

#### data

infered_type/: type information generated by TypeOracle
ground_truth/: correct type information (from reverse engineering)

#### utility

foxit.txt: comparasion log file
cmp_arg.py: the script file to compare type information

#### result

foxit_sample_result.txt: accuracy log file (the detail of accuracy comparasion)

### How to reproduce

1. copy all files from data to utility
2. python cmp_arg.py
3. the result will show

## Fuzzing Performance 

All files that generated in coverage recording process can be downloaded from https://drive.google.com/file/d/1SUDmnky_Py1rdqMQcPu7rBOBWDD3_7Ll/view?usp=sharing. 
Test cases can be downloaded from https://drive.google.com/file/d/1-zrRJrSwe4MVSnTEpeBduga--ZnP1ZHT/view?usp=sharing. Due to the space limitation, we only uploaded a set of experimental data. 

### Group1: Type Guidance (Figure 8(a), Figure 9(a))
#### adobe reader (Figure 8(a))

We use the random type of documented binding calls, all (documented+undocumented) binding calls, type information of Adobe Manual and type information of TypeOracle to fuzz Adobe and record coverage information using DynamoRIO.

data/:

document: randomly fuzzing documented binding calls

random: randomly fuzzing all (documented+undocumented) binding calls

adobe_manual: fuzzing all binding calls using Adobe Manual

typeoracle: fuzzing all binding calls using TypeOracle

utility/:

draw_all.py: the script file to parse coverage information

result/:

adobe_type.pdf: Figure 8(a)


#### foxit reader (Figure 9(a))

We use the type information of Adobe Document, random type of all (documented+undocumented) binding calls, Adobe's type information of TypeOracle and Foxit's type information of TypeOracle to fuzz Foxit and record coverage information using DynamoRIO

data/:

adobe_manual: fuzzing all binding calls using Adobe Manual

random: randomly fuzzing all (documented+undocumented) binding calls

typeoracle_adobe: fuzzing all binding calls using TypeOracle of Adobe

typeoracle_foxit: fuzzing all binding calls using TypeOracle of Foxit

utility/:

draw_all.py: the script file to parse coverage information

result/:

foxit_type.pdf: Figure 9(a)


### Group2: Coverage Guidance (Figure 8(b), Figure 9(b))
#### adobe reader (Figure 8(b))

We use all (documented+undocumented) binding calls, all (documented+undocumented) binding calls with coverage guidance, type information of TypeOracle and type information of TypeOracle with coverage guidance to fuzz Adobe and record coverage information using DynamoRIO.

data/:

random: randomly fuzzing all (documented+undocumented) binding calls

coverage_random: randomly fuzzing all (documented+undocumented) binding calls with coverage guidance

typeoracle: fuzzing all binding calls using TypeOracle

coverage_typeoracle: fuzzing all binding calls using TypeOracle with coverage guidance

utility/:

draw_all.py: the script file to parse coverage information

result/:

adobe_cov.pdf: Figure 8(b)

#### foxit reader (Figure 9(b))

We use all (documented+undocumented) binding calls, all (documented+undocumented) binding calls with coverage guidance, type information of TypeOracle and type information of TypeOracle with coverage guidance to fuzz Foxit and record coverage information using DynamoRIO.

data/:

random: randomly fuzzing all (documented+undocumented) binding calls

coverage_random: randomly fuzzing all (documented+undocumented) binding calls with coverage guidance

typeoracle_foxit: fuzzing all binding calls using TypeOracle

coverage_typeoracle: fuzzing all binding calls using TypeOracle with coverage guidance

utility/:

draw_all.py: the script file to parse coverage information

result/:

foxit_cov.pdf: Figure 9(b)

### Group3: Integration with State-of-Art Binding Call Fuzzers(Favocado) (Figure 8(c), Figure 9(c))
#### adobe reader (Figure 8(c))

we use Favocado and Favocado with type information of TypeOracle to fuzz Adobe and  record coverage information using DynamoRIO

data/:

favocado: fuzzing all binding calls using Favocado

favocado_typeoracle: fuzzing all binding calls using combination of TypeOracle and Favocado

utility/:

draw_all.py: the script file to parse coverage information

result/:

adobe_favocado.pdf: Figure8(c)

#### foxit reader (Figure 9(c))

we use Favocado and Favocado with type information of TypeOracle to fuzz Foxit and  record coverage information using DynamoRIO

data/:

favocado: fuzzing all binding calls using Favocado

favocado_typeoracle: fuzzing all binding calls using combination of TypeOracle and Favocado

utility/:

draw_all.py: the script file to parse coverage information

result/:

foxit_favocado.pdf: Figure9(c)

### Group3: Integration with State-of-Art Binding Call Fuzzers(Cooper) (Figure 8(d), Figure 9(d))
#### adobe reader (Figure 8(d))

we use Cooper and Cooper with type information of TypeOracle to fuzz Adobe and  record coverage information using DynamoRIO

data/:

cooper: fuzzing all binding calls using Cooper

cooper_typeoracle: fuzzing all binding calls using combination of TypeOracle and Cooper

utility/:

draw_all.py: the script file to parse coverage information

result/:

adobe_cooper.pdf: Figure8(d)


#### foxit reader (Figure 9(d))

we use Cooper and Cooper with type information of TypeOracle to fuzz Foxit and  record coverage information using DynamoRIO

data/:

cooper: fuzzing all binding calls using Cooper

cooper_typeoracle: fuzzing all binding calls using combination of TypeOracle and Cooper

utility/:

draw_all.py: the script file to parse coverage information

result/:

foxit_cooper.pdf: Figure9(d)

### The way to reproduce

1. copy all files from data to utility
2. python draw_all.py (matplotlib is needed, pip install matplotlib)
3. the result will show

## Vulnerabilities (Table 2)
### adobe reader

All the PoCs that we found on Adobe Reader.

1. turn on the page heap: .\gflags.exe /p /enable "C:\Program Files (x86)\Adobe\Acrobat Reader DC\Reader\AcroRd32.exe" 

2. add poc's folder into Adobe's trust path.
Edit->Preferences->Security(Enhanced)->Add Folder Path

3. open the pdf and adobe reader will crash or halt (sometimes you need to close dialog)

### foxit reader

All the PoCs that we found on Foxit Reader.

1. turn on the page heap: .\gflags.exe /p /enable "C:\Program Files (x86)\Foxit Software\Foxit Reader\FoxitReader.exe"

2. open foxit reader and use windbg to attach it

3. open the pdf and windbg will catch the exception (sometimes you need to close dialog)


# Utility

Can be downloaded from https://drive.google.com/file/d/1KeQNjcNm6109GV-4cam0TIdpldLyQMpR/view?usp=sharing

## crashinfo

parse the crashinfo logged by event viewer of windows and get unique crash

## parse_cov

parse coverage file genarated by DynamoRIO

## recored_cov

record coverage information using DynamoRIO

## bbkn2insn

count number of instructions

# How to reproduce (using FuzzingPerformance_data/adobe reader/typeoracle as an example)


1. copy test PDFs from FuzzingPerformance_data/adobe reader/typeoracle to utility/record_cov/adobe/test

2. cd utility/record_cov/adobe

3. run the tool and record coverage info

```
python run.py
```

4. copy coverage file from utility/record_cov/adobe/db to utility/parse_covfile/sample_data
5. cd utility/record_cov
6.  run the tool and parse coverage information

```
python frame.py
```

6. copy coverage file from utility/parse_covfile/sample_output to utility/bbkn2insn/adobe_sample_input
7. cd utility/bbkn2insn

8. run the tool and count number of instruction

```
python batch.py
python combine.py
python res.py
```
